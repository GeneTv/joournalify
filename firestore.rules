rules_version = '2';
service cloud.firestore {


  match /databases/{database}/documents {
    match /{document=**} {
      allow read, write, delete, create: if false;
    }

    //Handle journals
    
    // [AUTH] Allow read and create
		match /journals/{journal} {
    	allow read, create: if true;
    }
    
    // [AUTH] Allow delete own journal
    match /journals/{journal} {
    	allow delete: if isAuthorized();
    }
    
    // [AUTH] Allow write own journal
    match /journals/{journal} {
    	allow write: if isAuthorized();
    }



    //Handle feedback

    match /feedback/{feedback} { //Allow read: feedback on own journals & own feedback on any journals 
      allow read: if isLoggedIn() &&
        exists(/journals/$(feedback).data.journal) &&
        (/journals/$(feedback).data.journal).data.author == request; // @TODO:!!!!!
    }
    
  }
  
  
  function isLoggedIn() {
  	return request.auth != null;
	}
  function isAuthorized() {
  	return isLoggedIn() && resource != null && resource.data.author == request.auth.uid;
	}
}